{"version":3,"file":"browser.js.map","sources":["browser/util.js","browser/childrunner.js","browser/config.js","browser/suites.js","browser/reporters/console.js","browser/reporters/html.js","browser/reporters/multi.js","browser/reporters/title.js","browser/reporters.js","browser/environment.js","browser/environment/errors.js","browser/mocha/extend.js","browser/mocha/fixture.js","browser/mocha/stub.js","browser/mocha/replace.js","browser/mocha.js","browser/clisocket.js","browser/environment/helpers.js","browser/index.js"],"sourcesContent":["/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\n\r\nimport * as config from './config.js';\r\n\r\n/**\r\n * @param {function()} callback A function to call when the active web component\r\n *     frameworks have loaded.\r\n */\r\nexport function whenFrameworksReady(callback) {\r\n  debug('whenFrameworksReady');\r\n  var done = function() {\r\n    debug('whenFrameworksReady done');\r\n    callback();\r\n  };\r\n\r\n  function whenWebComponentsReady() {\r\n    debug('WebComponentsReady?');\r\n    if (window.WebComponents && WebComponents.whenReady) {\r\n      WebComponents.whenReady(function() {\r\n        debug('WebComponents Ready');\r\n        done();\r\n      });\r\n    } else {\r\n      var after = function after() {\r\n        window.removeEventListener('WebComponentsReady', after);\r\n        debug('WebComponentsReady');\r\n        done();\r\n      };\r\n      window.addEventListener('WebComponentsReady', after);\r\n    }\r\n  }\r\n\r\n  function importsReady() {\r\n    // handle Polymer 0.5 readiness\r\n    debug('Polymer ready?');\r\n    if (window.Polymer && Polymer.whenReady) {\r\n      Polymer.whenReady(function() {\r\n        debug('Polymer ready');\r\n        done();\r\n      });\r\n    } else {\r\n      whenWebComponentsReady();\r\n    }\r\n  }\r\n\r\n  // All our supported framework configurations depend on imports.\r\n  if (!window.HTMLImports) {\r\n    if (document.querySelector('script[src*=\"webcomponents\"]')) {\r\n      whenWebComponentsReady();\r\n    } else {\r\n      done();\r\n    }\r\n  } else if (HTMLImports.ready) {\r\n    debug('HTMLImports ready');\r\n    importsReady();\r\n  } else if (HTMLImports.whenReady) {\r\n    HTMLImports.whenReady(function() {\r\n      debug('HTMLImports.whenReady ready');\r\n      importsReady();\r\n    });\r\n  } else {\r\n    whenWebComponentsReady();\r\n  }\r\n}\r\n\r\n/**\r\n * @param {number} count\r\n * @param {string} kind\r\n * @return {string} '<count> <kind> tests' or '<count> <kind> test'.\r\n */\r\nexport function pluralizedStat(count, kind) {\r\n  if (count === 1) {\r\n    return count + ' ' + kind + ' test';\r\n  } else {\r\n    return count + ' ' + kind + ' tests';\r\n  }\r\n}\r\n\r\n/**\r\n * @param {string} path The URI of the script to load.\r\n * @param {function} done\r\n */\r\nexport function loadScript(path, done) {\r\n  var script = document.createElement('script');\r\n  script.src = path;\r\n  if (done) {\r\n    script.onload = done.bind(null, null);\r\n    script.onerror = done.bind(null, 'Failed to load script ' + script.src);\r\n  }\r\n  document.head.appendChild(script);\r\n}\r\n\r\n/**\r\n * @param {string} path The URI of the stylesheet to load.\r\n * @param {function} done\r\n */\r\nexport function loadStyle(path, done) {\r\n  var link = document.createElement('link');\r\n  link.rel = 'stylesheet';\r\n  link.href = path;\r\n  if (done) {\r\n    link.onload = done.bind(null, null);\r\n    link.onerror = done.bind(null, 'Failed to load stylesheet ' + link.href);\r\n  }\r\n  document.head.appendChild(link);\r\n}\r\n\r\n/**\r\n * @param {...*} var_args Logs values to the console when the `debug`\r\n *     configuration option is true.\r\n */\r\nexport function debug(var_args) {\r\n  if (!config.get('verbose')) return;\r\n  var args = [window.location.pathname];\r\n  args.push.apply(args, arguments);\r\n  (console.debug || console.log).apply(console, args);\r\n}\r\n\r\n// URL Processing\r\n\r\n/**\r\n * @param {string} url\r\n * @return {{base: string, params: string}}\r\n */\r\nexport function parseUrl(url) {\r\n  var parts = url.match(/^(.*?)(?:\\?(.*))?$/);\r\n  return {\r\n    base: parts[1],\r\n    params: getParams(parts[2] || ''),\r\n  };\r\n}\r\n\r\n/**\r\n * Expands a URL that may or may not be relative to `base`.\r\n *\r\n * @param {string} url\r\n * @param {string} base\r\n * @return {string}\r\n */\r\nexport function expandUrl(url, base) {\r\n  if (!base) return url;\r\n  if (url.match(/^(\\/|https?:\\/\\/)/)) return url;\r\n  if (base.substr(base.length - 1) !== '/') {\r\n    base = base + '/';\r\n  }\r\n  return base + url;\r\n}\r\n\r\n/**\r\n * @param {string=} opt_query A query string to parse.\r\n * @return {!Object<string, !Array<string>>} All params on the URL's query.\r\n */\r\nexport function getParams(opt_query) {\r\n  var query = typeof opt_query === 'string' ? opt_query : window.location.search;\r\n  if (query.substring(0, 1) === '?') {\r\n    query = query.substring(1);\r\n  }\r\n  // python's SimpleHTTPServer tacks a `/` on the end of query strings :(\r\n  if (query.slice(-1) === '/') {\r\n    query = query.substring(0, query.length - 1);\r\n  }\r\n  if (query === '') return {};\r\n\r\n  var result = {};\r\n  query.split('&').forEach(function(part) {\r\n    var pair = part.split('=');\r\n    if (pair.length !== 2) {\r\n      console.warn('Invalid URL query part:', part);\r\n      return;\r\n    }\r\n    var key = decodeURIComponent(pair[0]);\r\n    var value = decodeURIComponent(pair[1]);\r\n\r\n    if (!result[key]) {\r\n      result[key] = [];\r\n    }\r\n    result[key].push(value);\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\n/**\r\n * Merges params from `source` into `target` (mutating `target`).\r\n *\r\n * @param {!Object<string, !Array<string>>} target\r\n * @param {!Object<string, !Array<string>>} source\r\n */\r\nexport function mergeParams(target, source) {\r\n  Object.keys(source).forEach(function(key) {\r\n    if (!(key in target)) {\r\n      target[key] = [];\r\n    }\r\n    target[key] = target[key].concat(source[key]);\r\n  });\r\n}\r\n\r\n/**\r\n * @param {string} param The param to return a value for.\r\n * @return {?string} The first value for `param`, if found.\r\n */\r\nexport function getParam(param) {\r\n  var params = getParams();\r\n  return params[param] ? params[param][0] : null;\r\n}\r\n\r\n/**\r\n * @param {!Object<string, !Array<string>>} params\r\n * @return {string} `params` encoded as a URI query.\r\n */\r\nexport function paramsToQuery(params) {\r\n  var pairs = [];\r\n  Object.keys(params).forEach(function(key) {\r\n    params[key].forEach(function(value) {\r\n      pairs.push(encodeURIComponent(key) + '=' + encodeURIComponent(value));\r\n    });\r\n  });\r\n  return (pairs.length > 0) ? ('?' + pairs.join('&')) : '';\r\n}\r\n\r\n/**\r\n * @param {!Location|string} location\r\n * @return {string}\r\n */\r\nexport function basePath(location) {\r\n  return (location.pathname || location).match(/^.*\\//)[0];\r\n}\r\n\r\n/**\r\n * @param {!Location|string} location\r\n * @param {string} basePath\r\n * @return {string}\r\n */\r\nexport function relativeLocation(location, basePath) {\r\n  var path = location.pathname || location;\r\n  if (path.indexOf(basePath) === 0) {\r\n    path = path.substring(basePath.length);\r\n  }\r\n  return path;\r\n}\r\n\r\n/**\r\n * @param {!Location|string} location\r\n * @return {string}\r\n */\r\nexport function cleanLocation(location) {\r\n  var path = location.pathname || location;\r\n  if (path.slice(-11) === '/index.html') {\r\n    path = path.slice(0, path.length - 10);\r\n  }\r\n  return path;\r\n}\r\n\r\n/**\r\n * Like `async.parallelLimit`, but our own so that we don't force a dependency\r\n * on downstream code.\r\n *\r\n * @param {!Array<function(function(*))>} runners Runners that call their given\r\n *     Node-style callback when done.\r\n * @param {number|function(*)} limit Maximum number of concurrent runners.\r\n *     (optional).\r\n * @param {?function(*)} done Callback that should be triggered once all runners\r\n *     have completed, or encountered an error.\r\n */\r\nexport function parallel(runners, limit, done) {\r\n  if (typeof limit !== 'number') {\r\n    done = limit;\r\n    limit = 0;\r\n  }\r\n  if (!runners.length) return done();\r\n\r\n  var called = false;\r\n  var total = runners.length;\r\n  var numActive = 0;\r\n  var numDone = 0;\r\n\r\n  function runnerDone(error) {\r\n    if (called) return;\r\n    numDone = numDone + 1;\r\n    numActive = numActive - 1;\r\n\r\n    if (error || numDone >= total) {\r\n      called = true;\r\n      done(error);\r\n    } else {\r\n      runOne();\r\n    }\r\n  }\r\n\r\n  function runOne() {\r\n    if (limit && numActive >= limit) return;\r\n    if (!runners.length) return;\r\n    numActive = numActive + 1;\r\n    runners.shift()(runnerDone);\r\n  }\r\n  runners.forEach(runOne);\r\n}\r\n\r\n/**\r\n * Finds the directory that a loaded script is hosted on.\r\n *\r\n * @param {string} filename\r\n * @return {string?}\r\n */\r\nexport function scriptPrefix(filename) {\r\n  var scripts = document.querySelectorAll('script[src*=\"' + filename + '\"]');\r\n  if (scripts.length !== 1) return null;\r\n  var script = scripts[0].src;\r\n  return script.substring(0, script.indexOf(filename));\r\n}","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as util from './util.js';\r\n\r\n// TODO(thedeeno): Consider renaming subsuite. IIRC, childRunner is entirely\r\n// distinct from mocha suite, which tripped me up badly when trying to add\r\n// plugin support. Perhaps something like 'batch', or 'bundle'. Something that\r\n// has no mocha correlate. This may also eliminate the need for root/non-root\r\n// suite distinctions.\r\n\r\n/**\r\n * A Mocha suite (or suites) run within a child iframe, but reported as if they\r\n * are part of the current context.\r\n */\r\nexport default function ChildRunner(url, parentScope) {\r\n  var urlBits = util.parseUrl(url);\r\n  util.mergeParams(\r\n      urlBits.params, util.getParams(parentScope.location.search));\r\n  delete urlBits.params.cli_browser_id;\r\n\r\n  this.url         = urlBits.base + util.paramsToQuery(urlBits.params);\r\n  this.parentScope = parentScope;\r\n\r\n  this.state = 'initializing';\r\n}\r\n\r\n// ChildRunners get a pretty generous load timeout by default.\r\nChildRunner.loadTimeout = 60000;\r\n\r\n// We can't maintain properties on iframe elements in Firefox/Safari/???, so we\r\n// track childRunners by URL.\r\nChildRunner._byUrl = {};\r\n\r\n/**\r\n * @return {ChildRunner} The `ChildRunner` that was registered for this window.\r\n */\r\nChildRunner.current = function() {\r\n  return ChildRunner.get(window);\r\n};\r\n\r\n/**\r\n * @param {!Window} target A window to find the ChildRunner of.\r\n * @param {boolean} traversal Whether this is a traversal from a child window.\r\n * @return {ChildRunner} The `ChildRunner` that was registered for `target`.\r\n */\r\nChildRunner.get = function(target, traversal) {\r\n  var childRunner = ChildRunner._byUrl[target.location.href];\r\n  if (childRunner) return childRunner;\r\n  if (window.parent === window) {  // Top window.\r\n    if (traversal) {\r\n      console.warn('Subsuite loaded but was never registered. This most likely is due to wonky history behavior. Reloading...');\r\n      window.location.reload();\r\n    }\r\n    return null;\r\n  }\r\n  // Otherwise, traverse.\r\n  return window.parent.WCT._ChildRunner.get(target, true);\r\n};\r\n\r\n/**\r\n * Loads and runs the subsuite.\r\n *\r\n * @param {function} done Node-style callback.\r\n */\r\nChildRunner.prototype.run = function(done) {\r\n  util.debug('ChildRunner#run', this.url);\r\n  this.state = 'loading';\r\n  this.onRunComplete = done;\r\n\r\n  this.iframe = document.createElement('iframe');\r\n  this.iframe.src = this.url;\r\n  this.iframe.classList.add('subsuite');\r\n\r\n  var container = document.getElementById('subsuites');\r\n  if (!container) {\r\n    container = document.createElement('div');\r\n    container.id = 'subsuites';\r\n    document.body.appendChild(container);\r\n  }\r\n  container.appendChild(this.iframe);\r\n\r\n  // let the iframe expand the URL for us.\r\n  this.url = this.iframe.src;\r\n  ChildRunner._byUrl[this.url] = this;\r\n\r\n  this.timeoutId = setTimeout(\r\n      this.loaded.bind(this, new Error('Timed out loading ' + this.url)), ChildRunner.loadTimeout);\r\n\r\n  this.iframe.addEventListener('error',\r\n      this.loaded.bind(this, new Error('Failed to load document ' + this.url)));\r\n\r\n  this.iframe.contentWindow.addEventListener('DOMContentLoaded', this.loaded.bind(this, null));\r\n};\r\n\r\n/**\r\n * Called when the sub suite's iframe has loaded (or errored during load).\r\n *\r\n * @param {*} error The error that occured, if any.\r\n */\r\nChildRunner.prototype.loaded = function(error) {\r\n  util.debug('ChildRunner#loaded', this.url, error);\r\n\r\n  // Not all targets have WCT loaded (compatiblity mode)\r\n  if (this.iframe.contentWindow.WCT) {\r\n    this.share = this.iframe.contentWindow.WCT.share;\r\n  }\r\n\r\n  if (error) {\r\n    this.signalRunComplete(error);\r\n    this.done();\r\n  }\r\n};\r\n\r\n/**\r\n * Called in mocha/run.js when all dependencies have loaded, and the child is\r\n * ready to start running tests\r\n *\r\n * @param {*} error The error that occured, if any.\r\n */\r\nChildRunner.prototype.ready = function(error) {\r\n  util.debug('ChildRunner#ready', this.url, error);\r\n  if (this.timeoutId) {\r\n    clearTimeout(this.timeoutId);\r\n  }\r\n  if (error) {\r\n    this.signalRunComplete(error);\r\n    this.done();\r\n  }\r\n};\r\n\r\n/** Called when the sub suite's tests are complete, so that it can clean up. */\r\nChildRunner.prototype.done = function done() {\r\n  util.debug('ChildRunner#done', this.url, arguments);\r\n\r\n  // make sure to clear that timeout\r\n  this.ready();\r\n  this.signalRunComplete();\r\n\r\n  if (!this.iframe) return;\r\n  // Be safe and avoid potential browser crashes when logic attempts to interact\r\n  // with the removed iframe.\r\n  setTimeout(function() {\r\n    this.iframe.parentNode.removeChild(this.iframe);\r\n    this.iframe = null;\r\n  }.bind(this), 1);\r\n};\r\n\r\nChildRunner.prototype.signalRunComplete = function signalRunComplete(error) {\r\n  if (!this.onRunComplete) return;\r\n  this.state = 'complete';\r\n  this.onRunComplete(error);\r\n  this.onRunComplete = null;\r\n};\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as util from './util.js';\r\nimport ChildRunner from './childrunner.js';\r\n\r\n/**\r\n * The global configuration state for WCT's browser client.\r\n */\r\nexport var _config = {\r\n  /**\r\n   * `.js` scripts to be loaded (synchronously) before WCT starts in earnest.\r\n   *\r\n   * Paths are relative to `scriptPrefix`.\r\n   */\r\n  environmentScripts: [\r\n    'stacky/browser.js',\r\n    'async/lib/async.js',\r\n    'lodash/lodash.js',\r\n    'mocha/mocha.js',\r\n    'chai/chai.js',\r\n    'sinonjs/sinon.js',\r\n    'sinon-chai/lib/sinon-chai.js',\r\n    'accessibility-developer-tools/dist/js/axs_testing.js'\r\n  ],\r\n\r\n  environmentImports: [\r\n    'test-fixture/test-fixture.html'\r\n  ],\r\n\r\n  /** Absolute root for client scripts. Detected in `setup()` if not set. */\r\n  root: null,\r\n\r\n  /** By default, we wait for any web component frameworks to load. */\r\n  waitForFrameworks: true,\r\n\r\n  /** Alternate callback for waiting for tests.\r\n   * `this` for the callback will be the window currently running tests.\r\n   */\r\n  waitFor: null,\r\n\r\n  /** How many `.html` suites that can be concurrently loaded & run. */\r\n  numConcurrentSuites: 1,\r\n\r\n  /** Whether `console.error` should be treated as a test failure. */\r\n  trackConsoleError: true,\r\n\r\n  /** Configuration passed to mocha.setup. */\r\n  mochaOptions: {\r\n    timeout: 10 * 1000\r\n  },\r\n\r\n  /** Whether WCT should emit (extremely verbose) debugging log messages. */\r\n  verbose: false,\r\n};\r\n\r\n/**\r\n * Merges initial `options` into WCT's global configuration.\r\n *\r\n * @param {Object} options The options to merge. See `browser/config.js` for a\r\n *     reference.\r\n */\r\nexport function setup(options) {\r\n  var childRunner = ChildRunner.current();\r\n  if (childRunner) {\r\n    _deepMerge(_config, childRunner.parentScope.WCT._config);\r\n    // But do not force the mocha UI\r\n    delete _config.mochaOptions.ui;\r\n  }\r\n\r\n  if (options && typeof options === 'object') {\r\n    _deepMerge(_config, options);\r\n  }\r\n\r\n  if (!_config.root) {\r\n    // Sibling dependencies.\r\n    var root = util.scriptPrefix('browser.js');\r\n    _config.root = util.basePath(root.substr(0, root.length - 1));\r\n    if (!_config.root) {\r\n      throw new Error('Unable to detect root URL for WCT sources. Please set WCT.root before including browser.js');\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Retrieves a configuration value.\r\n *\r\n * @param {string} key\r\n * @return {*}\r\n */\r\nexport function get(key) {\r\n  return _config[key];\r\n}\r\n\r\n// Internal\r\n\r\nfunction _deepMerge(target, source) {\r\n  Object.keys(source).forEach(function (key) {\r\n    if (target[key] !== null && typeof target[key] === 'object' && !Array.isArray(target[key])) {\r\n      _deepMerge(target[key], source[key]);\r\n    } else {\r\n      target[key] = source[key];\r\n    }\r\n  });\r\n}\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as config from './config.js';\r\nimport * as util from './util.js';\r\nimport ChildRunner from './childrunner.js';\r\n\r\nexport var htmlSuites = [];\r\nexport var jsSuites = [];\r\n\r\n// We process grep ourselves to avoid loading suites that will be filtered.\r\nvar GREP = util.getParam('grep');\r\n// work around mocha bug (https://github.com/mochajs/mocha/issues/2070)\r\nif (GREP) {\r\n  GREP = GREP.replace(/\\\\\\./g, '.');\r\n}\r\n\r\n/**\r\n * Loads suites of tests, supporting both `.js` and `.html` files.\r\n *\r\n * @param {!Array.<string>} files The files to load.\r\n */\r\nexport function loadSuites(files) {\r\n  files.forEach(function(file) {\r\n    if (/\\.js(\\?.*)?$/.test(file)) {\r\n      jsSuites.push(file);\r\n    } else if (/\\.html(\\?.*)?$/.test(file)) {\r\n      htmlSuites.push(file);\r\n    } else {\r\n      throw new Error('Unknown resource type: ' + file);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * @return {!Array.<string>} The child suites that should be loaded, ignoring\r\n *     those that would not match `GREP`.\r\n */\r\nexport function activeChildSuites() {\r\n  var subsuites = htmlSuites;\r\n  if (GREP) {\r\n    var cleanSubsuites = [];\r\n    for (var i = 0, subsuite; subsuite = subsuites[i]; i++) {\r\n      if (GREP.indexOf(util.cleanLocation(subsuite)) !== -1) {\r\n        cleanSubsuites.push(subsuite);\r\n      }\r\n    }\r\n    subsuites = cleanSubsuites;\r\n  }\r\n  return subsuites;\r\n}\r\n\r\n/**\r\n * Loads all `.js` sources requested by the current suite.\r\n *\r\n * @param {!MultiReporter} reporter\r\n * @param {function} done\r\n */\r\nexport function loadJsSuites(reporter, done) {\r\n  util.debug('loadJsSuites', jsSuites);\r\n\r\n  var loaders = jsSuites.map(function(file) {\r\n    // We only support `.js` dependencies for now.\r\n    return util.loadScript.bind(util, file);\r\n  });\r\n\r\n  util.parallel(loaders, done);\r\n}\r\n\r\n/**\r\n * @param {!MultiReporter} reporter\r\n * @param {!Array.<string>} childSuites\r\n * @param {function} done\r\n */\r\nexport function runSuites(reporter, childSuites, done) {\r\n  util.debug('runSuites');\r\n\r\n  var suiteRunners = [\r\n    // Run the local tests (if any) first, not stopping on error;\r\n    _runMocha.bind(null, reporter),\r\n  ];\r\n\r\n  // As well as any sub suites. Again, don't stop on error.\r\n  childSuites.forEach(function(file) {\r\n    suiteRunners.push(function(next) {\r\n      var childRunner = new ChildRunner(file, window);\r\n      reporter.emit('childRunner start', childRunner);\r\n      childRunner.run(function(error) {\r\n        reporter.emit('childRunner end', childRunner);\r\n        if (error) reporter.emitOutOfBandTest(file, error);\r\n        next();\r\n      });\r\n    });\r\n  });\r\n\r\n  util.parallel(suiteRunners, config.get('numConcurrentSuites'), function(error) {\r\n    reporter.done();\r\n    done(error);\r\n  });\r\n}\r\n\r\n/**\r\n * Kicks off a mocha run, waiting for frameworks to load if necessary.\r\n *\r\n * @param {!MultiReporter} reporter Where to send Mocha's events.\r\n * @param {function} done A callback fired, _no error is passed_.\r\n */\r\nfunction _runMocha(reporter, done, waited) {\r\n  if (config.get('waitForFrameworks') && !waited) {\r\n    var waitFor = (config.get('waitFor') || util.whenFrameworksReady).bind(window);\r\n    waitFor(function() {\r\n      _fixCustomElements();\r\n      _runMocha(reporter, done, true);\r\n    });\r\n    return;\r\n  }\r\n  util.debug('_runMocha');\r\n  var mocha = window.mocha;\r\n  var Mocha = window.Mocha;\r\n\r\n  mocha.reporter(reporter.childReporter(window.location));\r\n  mocha.suite.title = reporter.suiteTitle(window.location);\r\n  mocha.grep(GREP);\r\n\r\n  // We can't use `mocha.run` because it bashes over grep, invert, and friends.\r\n  // See https://github.com/visionmedia/mocha/blob/master/support/tail.js#L137\r\n  var runner = Mocha.prototype.run.call(mocha, function(error) {\r\n    if (document.getElementById('mocha')) {\r\n      Mocha.utils.highlightTags('code');\r\n    }\r\n    done(); // We ignore the Mocha failure count.\r\n  });\r\n\r\n  // Mocha's default `onerror` handling strips the stack (to support really old\r\n  // browsers). We upgrade this to get better stacks for async errors.\r\n  //\r\n  // TODO(nevir): Can we expand support to other browsers?\r\n  if (navigator.userAgent.match(/chrome/i)) {\r\n    window.onerror = null;\r\n    window.addEventListener('error', function(event) {\r\n      if (!event.error) return;\r\n      if (event.error.ignore) return;\r\n      runner.uncaught(event.error);\r\n    });\r\n  }\r\n}\r\n/**\r\n * In Chrome57 custom elements in the document might not get upgraded when\r\n * there is a high GC https://bugs.chromium.org/p/chromium/issues/detail?id=701601\r\n * We clone and replace the ones that weren't upgraded.\r\n */\r\nfunction _fixCustomElements() {\r\n  // Bail out if it is not Chrome 57.\r\n  var raw = navigator.userAgent.match(/Chrom(e|ium)\\/([0-9]+)\\./);\r\n  var isM57 = raw && raw[2] === '57';\r\n  if (!isM57) return;\r\n\r\n  var elements = document.body.querySelectorAll('*:not(script):not(style)');\r\n  var constructors = {};\r\n  for (var i = 0; i < elements.length; i++) {\r\n    var el = elements[i];\r\n    // This child has already been cloned and replaced by its parent, skip it!\r\n    if (!el.isConnected) continue;\r\n\r\n    var tag = el.localName;\r\n    // Not a custom element!\r\n    if (tag.indexOf('-') === -1) continue;\r\n\r\n    // Memoize correct constructors.\r\n    constructors[tag] = constructors[tag] || document.createElement(tag).constructor;\r\n    // This one was correctly upgraded.\r\n    if (el instanceof constructors[tag]) continue;\r\n\r\n    util.debug('_fixCustomElements: found non-upgraded custom element ' + el);\r\n    var clone = document.importNode(el, true);\r\n    el.parentNode.replaceChild(clone, el);\r\n  }\r\n}","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as util from '../util.js';\r\n\r\n// We capture console events when running tests; so make sure we have a\r\n// reference to the original one.\r\nvar console = window.console;\r\n\r\nvar FONT = ';font: normal 13px \"Roboto\", \"Helvetica Neue\", \"Helvetica\", sans-serif;';\r\nvar STYLES = {\r\n  plain:   FONT,\r\n  suite:   'color: #5c6bc0' + FONT,\r\n  test:    FONT,\r\n  passing: 'color: #259b24' + FONT,\r\n  pending: 'color: #e65100' + FONT,\r\n  failing: 'color: #c41411' + FONT,\r\n  stack:   'color: #c41411',\r\n  results: FONT + 'font-size: 16px',\r\n};\r\n\r\n// I don't think we can feature detect this one...\r\nvar userAgent = navigator.userAgent.toLowerCase();\r\nvar CAN_STYLE_LOG   = userAgent.match('firefox') || userAgent.match('webkit');\r\nvar CAN_STYLE_GROUP = userAgent.match('webkit');\r\n// Track the indent for faked `console.group`\r\nvar logIndent = '';\r\n\r\nfunction log(text, style) {\r\n  text = text.split('\\n').map(function(l) { return logIndent + l; }).join('\\n');\r\n  if (CAN_STYLE_LOG) {\r\n    console.log('%c' + text, STYLES[style] || STYLES.plain);\r\n  } else {\r\n    console.log(text);\r\n  }\r\n}\r\n\r\nfunction logGroup(text, style) {\r\n  if (CAN_STYLE_GROUP) {\r\n    console.group('%c' + text, STYLES[style] || STYLES.plain);\r\n  } else if (console.group) {\r\n    console.group(text);\r\n  } else {\r\n    logIndent = logIndent + '  ';\r\n    log(text, style);\r\n  }\r\n}\r\n\r\nfunction logGroupEnd() {\r\n  if (console.groupEnd) {\r\n    console.groupEnd();\r\n  } else {\r\n    logIndent = logIndent.substr(0, logIndent.length - 2);\r\n  }\r\n}\r\n\r\nfunction logException(error) {\r\n  log(error.stack || error.message || error, 'stack');\r\n}\r\n\r\n/**\r\n * A Mocha reporter that logs results out to the web `console`.\r\n *\r\n * @param {!Mocha.Runner} runner The runner that is being reported on.\r\n */\r\nexport default function Console(runner) {\r\n  Mocha.reporters.Base.call(this, runner);\r\n\r\n  runner.on('suite', function(suite) {\r\n    if (suite.root) return;\r\n    logGroup(suite.title, 'suite');\r\n  }.bind(this));\r\n\r\n  runner.on('suite end', function(suite) {\r\n    if (suite.root) return;\r\n    logGroupEnd();\r\n  }.bind(this));\r\n\r\n  runner.on('test', function(test) {\r\n    logGroup(test.title, 'test');\r\n  }.bind(this));\r\n\r\n  runner.on('pending', function(test) {\r\n    logGroup(test.title, 'pending');\r\n  }.bind(this));\r\n\r\n  runner.on('fail', function(test, error) {\r\n    logException(error);\r\n  }.bind(this));\r\n\r\n  runner.on('test end', function(test) {\r\n    logGroupEnd();\r\n  }.bind(this));\r\n\r\n  runner.on('end', this.logSummary.bind(this));\r\n}\r\n\r\n/** Prints out a final summary of test results. */\r\nConsole.prototype.logSummary = function logSummary() {\r\n  logGroup('Test Results', 'results');\r\n\r\n  if (this.stats.failures > 0) {\r\n    log(util.pluralizedStat(this.stats.failures, 'failing'), 'failing');\r\n  }\r\n  if (this.stats.pending > 0) {\r\n    log(util.pluralizedStat(this.stats.pending, 'pending'), 'pending');\r\n  }\r\n  log(util.pluralizedStat(this.stats.passes, 'passing'));\r\n\r\n  if (!this.stats.failures) {\r\n    log('test suite passed', 'passing');\r\n  }\r\n  log('Evaluated ' + this.stats.tests + ' tests in ' + this.stats.duration + 'ms.');\r\n  logGroupEnd();\r\n};\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\n\r\n/**\r\n * WCT-specific behavior on top of Mocha's default HTML reporter.\r\n *\r\n * @param {!Mocha.Runner} runner The runner that is being reported on.\r\n */\r\nexport default function HTML(runner) {\r\n  var output = document.createElement('div');\r\n  output.id = 'mocha';\r\n  document.body.appendChild(output);\r\n\r\n  runner.on('suite', function(test) {\r\n    this.total = runner.total;\r\n  }.bind(this));\r\n\r\n  Mocha.reporters.HTML.call(this, runner);\r\n}\r\n\r\n// Woo! What a hack. This just saves us from adding a bunch of complexity around\r\n// style loading.\r\nvar style = document.createElement('style');\r\nstyle.textContent = 'html, body {' +\r\n                    '  position: relative;' +\r\n                    '  height: 100%;' +\r\n                    '  width:  100%;' +\r\n                    '  min-width: 900px;' +\r\n                    '}' +\r\n                    '#mocha, #subsuites {' +\r\n                    '  height: 100%;' +\r\n                    '  position: absolute;' +\r\n                    '  top: 0;' +\r\n                    '}' +\r\n                    '#mocha {' +\r\n                    '  box-sizing: border-box;' +\r\n                    '  margin: 0 !important;' +\r\n                    '  overflow-y: auto;' +\r\n                    '  padding: 60px 20px;' +\r\n                    '  right: 0;' +\r\n                    '  left: 500px;' +\r\n                    '}' +\r\n                    '#subsuites {' +\r\n                    '  -ms-flex-direction: column;' +\r\n                    '  -webkit-flex-direction: column;' +\r\n                    '  display: -ms-flexbox;' +\r\n                    '  display: -webkit-flex;' +\r\n                    '  display: flex;' +\r\n                    '  flex-direction: column;' +\r\n                    '  left: 0;' +\r\n                    '  width: 500px;' +\r\n                    '}' +\r\n                    '#subsuites .subsuite {' +\r\n                    '  border: 0;' +\r\n                    '  width: 100%;' +\r\n                    '  height: 100%;' +\r\n                    '}' +\r\n                    '#mocha .test.pass .duration {' +\r\n                    '  color: #555 !important;' +\r\n                    '}';\r\ndocument.head.appendChild(style);\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as util from '../util.js';\r\n\r\nvar STACKY_CONFIG = {\r\n  indent: '  ',\r\n  locationStrip: [\r\n    /^https?:\\/\\/[^\\/]+/,\r\n    /\\?.*$/,\r\n  ],\r\n  filter: function(line) {\r\n    return line.location.match(/\\/web-component-tester\\/[^\\/]+(\\?.*)?$/);\r\n  },\r\n};\r\n\r\n// https://github.com/visionmedia/mocha/blob/master/lib/runner.js#L36-46\r\nvar MOCHA_EVENTS = [\r\n  'start',\r\n  'end',\r\n  'suite',\r\n  'suite end',\r\n  'test',\r\n  'test end',\r\n  'hook',\r\n  'hook end',\r\n  'pass',\r\n  'fail',\r\n  'pending',\r\n  'childRunner end'\r\n];\r\n\r\n// Until a suite has loaded, we assume this many tests in it.\r\nvar ESTIMATED_TESTS_PER_SUITE = 3;\r\n\r\n/**\r\n * A Mocha-like reporter that combines the output of multiple Mocha suites.\r\n *\r\n * @param {number} numSuites The number of suites that will be run, in order to\r\n *     estimate the total number of tests that will be performed.\r\n * @param {!Array.<!Mocha.reporters.Base>} reporters The set of reporters that\r\n *     should receive the unified event stream.\r\n * @param {MultiReporter} parent The parent reporter, if present.\r\n */\r\nexport default function MultiReporter(numSuites, reporters, parent) {\r\n  this.reporters = reporters.map(function(reporter) {\r\n    return new reporter(this);\r\n  }.bind(this));\r\n\r\n  this.parent = parent;\r\n  this.basePath = parent && parent.basePath || util.basePath(window.location);\r\n\r\n  this.total = numSuites * ESTIMATED_TESTS_PER_SUITE;\r\n  // Mocha reporters assume a stream of events, so we have to be careful to only\r\n  // report on one runner at a time...\r\n  this.currentRunner = null;\r\n  // ...while we buffer events for any other active runners.\r\n  this.pendingEvents = [];\r\n\r\n  this.emit('start');\r\n}\r\n\r\n/**\r\n * @param {!Location|string} location The location this reporter represents.\r\n * @return {!Mocha.reporters.Base} A reporter-like \"class\" for each child suite\r\n *     that should be passed to `mocha.run`.\r\n */\r\nMultiReporter.prototype.childReporter = function childReporter(location) {\r\n  var name = this.suiteTitle(location);\r\n  // The reporter is used as a constructor, so we can't depend on `this` being\r\n  // properly bound.\r\n  var self = this;\r\n  function reporter(runner) {\r\n    runner.name = name;\r\n    self.bindChildRunner(runner);\r\n  }\r\n  reporter.title = name;\r\n  return reporter;\r\n};\r\n\r\n/** Must be called once all runners have finished. */\r\nMultiReporter.prototype.done = function done() {\r\n  this.complete = true;\r\n  this.flushPendingEvents();\r\n  this.emit('end');\r\n};\r\n\r\n/**\r\n * Emit a top level test that is not part of any suite managed by this reporter.\r\n *\r\n * Helpful for reporting on global errors, loading issues, etc.\r\n *\r\n * @param {string} title The title of the test.\r\n * @param {*} opt_error An error associated with this test. If falsy, test is\r\n *     considered to be passing.\r\n * @param {string} opt_suiteTitle Title for the suite that's wrapping the test.\r\n * @param {?boolean} opt_estimated If this test was included in the original\r\n *     estimate of `numSuites`.\r\n */\r\nMultiReporter.prototype.emitOutOfBandTest = function emitOutOfBandTest(title, opt_error, opt_suiteTitle, opt_estimated) {\r\n  util.debug('MultiReporter#emitOutOfBandTest(', arguments, ')');\r\n  var root = new Mocha.Suite();\r\n  root.title = opt_suiteTitle || '';\r\n  var test = new Mocha.Test(title, function() {\r\n  });\r\n  test.parent = root;\r\n  test.state  = opt_error ? 'failed' : 'passed';\r\n  test.err    = opt_error;\r\n\r\n  if (!opt_estimated) {\r\n    this.total = this.total + ESTIMATED_TESTS_PER_SUITE;\r\n  }\r\n\r\n  var runner = {total: 1};\r\n  this.proxyEvent('start', runner);\r\n  this.proxyEvent('suite', runner, root);\r\n  this.proxyEvent('test', runner, test);\r\n  if (opt_error) {\r\n    this.proxyEvent('fail', runner, test, opt_error);\r\n  } else {\r\n    this.proxyEvent('pass', runner, test);\r\n  }\r\n  this.proxyEvent('test end', runner, test);\r\n  this.proxyEvent('suite end', runner, root);\r\n  this.proxyEvent('end', runner);\r\n};\r\n\r\n/**\r\n * @param {!Location|string} location\r\n * @return {string}\r\n */\r\nMultiReporter.prototype.suiteTitle = function suiteTitle(location) {\r\n  var path = util.relativeLocation(location, this.basePath);\r\n  path = util.cleanLocation(path);\r\n  return path;\r\n};\r\n\r\n// Internal Interface\r\n\r\n/** @param {!Mocha.runners.Base} runner The runner to listen to events for. */\r\nMultiReporter.prototype.bindChildRunner = function bindChildRunner(runner) {\r\n  MOCHA_EVENTS.forEach(function(eventName) {\r\n    runner.on(eventName, this.proxyEvent.bind(this, eventName, runner));\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n * Evaluates an event fired by `runner`, proxying it forward or buffering it.\r\n *\r\n * @param {string} eventName\r\n * @param {!Mocha.runners.Base} runner The runner that emitted this event.\r\n * @param {...*} var_args Any additional data passed as part of the event.\r\n */\r\nMultiReporter.prototype.proxyEvent = function proxyEvent(eventName, runner, var_args) {\r\n  var extraArgs = Array.prototype.slice.call(arguments, 2);\r\n  if (this.complete) {\r\n    console.warn('out of order Mocha event for ' + runner.name + ':', eventName, extraArgs);\r\n    return;\r\n  }\r\n\r\n  if (this.currentRunner && runner !== this.currentRunner) {\r\n    this.pendingEvents.push(arguments);\r\n    return;\r\n  }\r\n  util.debug('MultiReporter#proxyEvent(', arguments, ')');\r\n\r\n  // This appears to be a Mocha bug: Tests failed by passing an error to their\r\n  // done function don't set `err` properly.\r\n  //\r\n  // TODO(nevir): Track down.\r\n  if (eventName === 'fail' && !extraArgs[0].err) {\r\n    extraArgs[0].err = extraArgs[1];\r\n  }\r\n\r\n  if (eventName === 'start') {\r\n    this.onRunnerStart(runner);\r\n  } else if (eventName === 'end') {\r\n    this.onRunnerEnd(runner);\r\n  } else {\r\n    this.cleanEvent(eventName, runner, extraArgs);\r\n    this.emit.apply(this, [eventName].concat(extraArgs));\r\n  }\r\n};\r\n\r\n/**\r\n * Cleans or modifies an event if needed.\r\n *\r\n * @param {string} eventName\r\n * @param {!Mocha.runners.Base} runner The runner that emitted this event.\r\n * @param {!Array.<*>} extraArgs\r\n */\r\nMultiReporter.prototype.cleanEvent = function cleanEvent(eventName, runner, extraArgs) {\r\n  // Suite hierarchy\r\n  if (extraArgs[0]) {\r\n    extraArgs[0] = this.showRootSuite(extraArgs[0]);\r\n  }\r\n\r\n  // Normalize errors\r\n  if (eventName === 'fail') {\r\n    extraArgs[1] = Stacky.normalize(extraArgs[1], STACKY_CONFIG);\r\n  }\r\n  if (extraArgs[0] && extraArgs[0].err) {\r\n    extraArgs[0].err = Stacky.normalize(extraArgs[0].err, STACKY_CONFIG);\r\n  }\r\n};\r\n\r\n/**\r\n * We like to show the root suite's title, which requires a little bit of\r\n * trickery in the suite hierarchy.\r\n *\r\n * @param {!Mocha.Runnable} node\r\n */\r\nMultiReporter.prototype.showRootSuite = function showRootSuite(node) {\r\n  var leaf = node = Object.create(node);\r\n  while (node && node.parent) {\r\n    var wrappedParent = Object.create(node.parent);\r\n    node.parent = wrappedParent;\r\n    node = wrappedParent;\r\n  }\r\n  node.root = false;\r\n\r\n  return leaf;\r\n};\r\n\r\n/** @param {!Mocha.runners.Base} runner */\r\nMultiReporter.prototype.onRunnerStart = function onRunnerStart(runner) {\r\n  util.debug('MultiReporter#onRunnerStart:', runner.name);\r\n  this.total = this.total - ESTIMATED_TESTS_PER_SUITE + runner.total;\r\n  this.currentRunner = runner;\r\n};\r\n\r\n/** @param {!Mocha.runners.Base} runner */\r\nMultiReporter.prototype.onRunnerEnd = function onRunnerEnd(runner) {\r\n  util.debug('MultiReporter#onRunnerEnd:', runner.name);\r\n  this.currentRunner = null;\r\n  this.flushPendingEvents();\r\n};\r\n\r\n/**\r\n * Flushes any buffered events and runs them through `proxyEvent`. This will\r\n * loop until all buffered runners are complete, or we have run out of buffered\r\n * events.\r\n */\r\nMultiReporter.prototype.flushPendingEvents = function flushPendingEvents() {\r\n  var events = this.pendingEvents;\r\n  this.pendingEvents = [];\r\n  events.forEach(function(eventArgs) {\r\n    this.proxyEvent.apply(this, eventArgs);\r\n  }.bind(this));\r\n};\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as util from '../util.js';\r\n\r\nvar ARC_OFFSET = 0; // start at the right.\r\nvar ARC_WIDTH  = 6;\r\n\r\n/**\r\n * A Mocha reporter that updates the document's title and favicon with\r\n * at-a-glance stats.\r\n *\r\n * @param {!Mocha.Runner} runner The runner that is being reported on.\r\n */\r\nexport default function Title(runner) {\r\n  Mocha.reporters.Base.call(this, runner);\r\n\r\n  runner.on('test end', this.report.bind(this));\r\n}\r\n\r\n/** Reports current stats via the page title and favicon. */\r\nTitle.prototype.report = function report() {\r\n  this.updateTitle();\r\n  this.updateFavicon();\r\n};\r\n\r\n/** Updates the document title with a summary of current stats. */\r\nTitle.prototype.updateTitle = function updateTitle() {\r\n  if (this.stats.failures > 0) {\r\n    document.title = util.pluralizedStat(this.stats.failures, 'failing');\r\n  } else {\r\n    document.title = util.pluralizedStat(this.stats.passes, 'passing');\r\n  }\r\n};\r\n\r\n/**\r\n * Draws an arc for the favicon status, relative to the total number of tests.\r\n *\r\n * @param {!CanvasRenderingContext2D} context\r\n * @param {number} total\r\n * @param {number} start\r\n * @param {number} length\r\n * @param {string} color\r\n */\r\nfunction drawFaviconArc(context, total, start, length, color) {\r\n  var arcStart = ARC_OFFSET + Math.PI * 2 * (start / total);\r\n  var arcEnd   = ARC_OFFSET + Math.PI * 2 * ((start + length) / total);\r\n\r\n  context.beginPath();\r\n  context.strokeStyle = color;\r\n  context.lineWidth   = ARC_WIDTH;\r\n  context.arc(16, 16, 16 - ARC_WIDTH / 2, arcStart, arcEnd);\r\n  context.stroke();\r\n}\r\n\r\n/** Updates the document's favicon w/ a summary of current stats. */\r\nTitle.prototype.updateFavicon = function updateFavicon() {\r\n  var canvas = document.createElement('canvas');\r\n  canvas.height = canvas.width = 32;\r\n  var context = canvas.getContext('2d');\r\n\r\n  var passing = this.stats.passes;\r\n  var pending = this.stats.pending;\r\n  var failing = this.stats.failures;\r\n  var total   = Math.max(this.runner.total, passing + pending + failing);\r\n  drawFaviconArc(context, total, 0,                 passing, '#0e9c57');\r\n  drawFaviconArc(context, total, passing,           pending, '#f3b300');\r\n  drawFaviconArc(context, total, pending + passing, failing, '#ff5621');\r\n\r\n  this.setFavicon(canvas.toDataURL());\r\n};\r\n\r\n/** Sets the current favicon by URL. */\r\nTitle.prototype.setFavicon = function setFavicon(url) {\r\n  var current = document.head.querySelector('link[rel=\"icon\"]');\r\n  if (current) {\r\n    document.head.removeChild(current);\r\n  }\r\n\r\n  var link = document.createElement('link');\r\n  link.rel = 'icon';\r\n  link.type = 'image/x-icon';\r\n  link.href = url;\r\n  link.setAttribute('sizes', '32x32');\r\n  document.head.appendChild(link);\r\n};\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as suites from './suites.js';\r\nimport ConsoleReporter from './reporters/console.js';\r\nimport HTMLReporter    from './reporters/html.js';\r\nimport MultiReporter   from './reporters/multi.js';\r\nimport TitleReporter   from './reporters/title.js';\r\n\r\nexport var htmlSuites = [];\r\nexport var jsSuites   = [];\r\n\r\n/**\r\n * @param {CLISocket} socket The CLI socket, if present.\r\n * @param {MultiReporter} parent The parent reporter, if present.\r\n * @return {!Array.<!Mocha.reporters.Base} The reporters that should be used.\r\n */\r\nexport function determineReporters(socket, parent) {\r\n  // Parents are greedy.\r\n  if (parent) {\r\n    return [parent.childReporter(window.location)];\r\n  }\r\n\r\n  // Otherwise, we get to run wild without any parental supervision!\r\n  var reporters = [TitleReporter, ConsoleReporter];\r\n\r\n  if (socket) {\r\n    reporters.push(function(runner) {\r\n      socket.observe(runner);\r\n    });\r\n  }\r\n\r\n  if (suites.htmlSuites.length > 0 || suites.jsSuites.length > 0) {\r\n    reporters.push(HTMLReporter);\r\n  }\r\n\r\n  return reporters;\r\n}\r\n\r\n/**\r\n * Yeah, hideous, but this allows us to be loaded before Mocha, which is handy.\r\n */\r\nexport function injectMocha(Mocha) {\r\n  _injectPrototype(ConsoleReporter, Mocha.reporters.Base.prototype);\r\n  _injectPrototype(HTMLReporter,    Mocha.reporters.HTML.prototype);\r\n  // Mocha doesn't expose its `EventEmitter` shim directly, so:\r\n  _injectPrototype(MultiReporter,   Object.getPrototypeOf(Mocha.Runner.prototype));\r\n}\r\n\r\nfunction _injectPrototype(klass, prototype) {\r\n  var newPrototype = Object.create(prototype);\r\n  // Only support\r\n  Object.keys(klass.prototype).forEach(function(key) {\r\n    newPrototype[key] = klass.prototype[key];\r\n  });\r\n\r\n  klass.prototype = newPrototype;\r\n}\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as config from './config.js';\r\nimport * as reporters from './reporters.js';\r\nimport * as util from './util.js';\r\n\r\n/**\r\n * Loads all environment scripts ...synchronously ...after us.\r\n */\r\nexport function loadSync() {\r\n  util.debug('Loading environment scripts:');\r\n  var a11ySuite = 'web-component-tester/data/a11ySuite.js';\r\n  var scripts = config.get('environmentScripts');\r\n  var a11ySuiteWillBeLoaded = window.__generatedByWct || scripts.indexOf(a11ySuite) > -1;\r\n  if (!a11ySuiteWillBeLoaded) {\r\n    // wct is running as a bower dependency, load a11ySuite from data/\r\n    scripts.push(a11ySuite);\r\n  }\r\n  scripts.forEach(function(path) {\r\n    var url = util.expandUrl(path, config.get('root'));\r\n    util.debug('Loading environment script:', url);\r\n    // Synchronous load.\r\n    document.write('<script src=\"' + encodeURI(url) + '\"></script>'); // jshint ignore:line\r\n  });\r\n  util.debug('Environment scripts loaded');\r\n\r\n  var imports = config.get('environmentImports');\r\n  imports.forEach(function(path) {\r\n    var url = util.expandUrl(path, config.get('root'));\r\n    util.debug('Loading environment import:', url);\r\n    // Synchronous load.\r\n    document.write('<link rel=\"import\" href=\"' + encodeURI(url) + '\">'); // jshint ignore:line\r\n  });\r\n  util.debug('Environment imports loaded');\r\n}\r\n\r\n/**\r\n * We have some hard dependencies on things that should be loaded via\r\n * `environmentScripts`, so we assert that they're present here; and do any\r\n * post-facto setup.\r\n */\r\nexport function ensureDependenciesPresent() {\r\n  _ensureMocha();\r\n  _checkChai();\r\n}\r\n\r\nfunction _ensureMocha() {\r\n  var Mocha = window.Mocha;\r\n  if (!Mocha) {\r\n    throw new Error('WCT requires Mocha. Please ensure that it is present in WCT.environmentScripts, or that you load it before loading web-component-tester/browser.js');\r\n  }\r\n  reporters.injectMocha(Mocha);\r\n  // Magic loading of mocha's stylesheet\r\n  var mochaPrefix = util.scriptPrefix('mocha.js');\r\n  // only load mocha stylesheet for the test runner output\r\n  // Not the end of the world, if it doesn't load.\r\n  if (mochaPrefix && window.top === window.self) {\r\n    util.loadStyle(mochaPrefix + 'mocha.css');\r\n  }\r\n}\r\n\r\nfunction _checkChai() {\r\n  if (!window.chai) {\r\n    util.debug('Chai not present; not registering shorthands');\r\n    return;\r\n  }\r\n\r\n  window.assert = window.chai.assert;\r\n  window.expect = window.chai.expect;\r\n}","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as config from '../config.js';\r\n\r\n// We may encounter errors during initialization (for example, syntax errors in\r\n// a test file). Hang onto those (and more) until we are ready to report them.\r\nexport var globalErrors = [];\r\n\r\n/**\r\n * Hook the environment to pick up on global errors.\r\n */\r\nexport function listenForErrors() {\r\n  window.addEventListener('error', function(event) {\r\n    globalErrors.push(event.error);\r\n  });\r\n\r\n  // Also, we treat `console.error` as a test failure. Unless you prefer not.\r\n  var origConsole = console;\r\n  var origError   = console.error;\r\n  console.error = function wctShimmedError() {\r\n    origError.apply(origConsole, arguments);\r\n    if (config.get('trackConsoleError')) {\r\n      throw 'console.error: ' + Array.prototype.join.call(arguments, ' ');\r\n    }\r\n  };\r\n}\r\n","\r\nvar interfaceExtensions = [];\r\n\r\n/**\r\n * Registers an extension that extends the global `Mocha` implementation\r\n * with new helper methods. These helper methods will be added to the `window`\r\n * when tests run for both BDD and TDD interfaces.\r\n */\r\nexport function extendInterfaces(helperName, helperFactory) {\r\n  interfaceExtensions.push(function() {\r\n    var Mocha = window.Mocha;\r\n    // For all Mocha interfaces (probably just TDD and BDD):\r\n    Object.keys(Mocha.interfaces).forEach(function(interfaceName) {\r\n      // This is the original callback that defines the interface (TDD or BDD):\r\n      var originalInterface = Mocha.interfaces[interfaceName];\r\n      // This is the name of the \"teardown\" or \"afterEach\" property for the\r\n      // current interface:\r\n      var teardownProperty = interfaceName === 'tdd' ? 'teardown' : 'afterEach';\r\n      // The original callback is monkey patched with a new one that appends to\r\n      // the global context however we want it to:\r\n      Mocha.interfaces[interfaceName] = function(suite) {\r\n        // Call back to the original callback so that we get the base interface:\r\n        originalInterface.apply(this, arguments);\r\n        // Register a listener so that we can further extend the base interface:\r\n        suite.on('pre-require', function(context, file, mocha) {\r\n          // Capture a bound reference to the teardown function as a convenience:\r\n          var teardown = context[teardownProperty].bind(context);\r\n          // Add our new helper to the testing context. The helper is generated\r\n          // by a factory method that receives the context, the teardown function\r\n          // and the interface name and returns the new method to be added to\r\n          // that context:\r\n          context[helperName] = helperFactory(context, teardown, interfaceName);\r\n        });\r\n      };\r\n    });\r\n  });\r\n}\r\n\r\n/**\r\n * Applies any registered interface extensions. The extensions will be applied\r\n * as many times as this function is called, so don't call it more than once.\r\n */\r\nexport function applyExtensions() {\r\n  interfaceExtensions.forEach(function(applyExtension) {\r\n    applyExtension();\r\n  });\r\n}\r\n","import { extendInterfaces } from './extend';\r\n\r\nextendInterfaces('fixture', function (context, teardown) {\r\n\r\n  // Return context.fixture if it is already a thing, for backwards\r\n  // compatibility with `test-fixture-mocha.js`:\r\n  return context.fixture || function fixture(fixtureId, model) {\r\n\r\n    // Automatically register a teardown callback that will restore the\r\n    // test-fixture:\r\n    teardown(function () {\r\n      document.getElementById(fixtureId).restore();\r\n    });\r\n\r\n    // Find the test-fixture with the provided ID and create it, returning\r\n    // the results:\r\n    return document.getElementById(fixtureId).create(model);\r\n  };\r\n});","import { extendInterfaces } from './extend';\r\n\r\n/**\r\n * stub\r\n *\r\n * The stub addon allows the tester to partially replace the implementation of\r\n * an element with some custom implementation. Usage example:\r\n *\r\n * beforeEach(function() {\r\n *   stub('x-foo', {\r\n *     attached: function() {\r\n *       // Custom implementation of the `attached` method of element `x-foo`..\r\n *     },\r\n *     otherMethod: function() {\r\n *       // More custom implementation..\r\n *     },\r\n *     getterSetterProperty: {\r\n *       get: function() {\r\n *         // Custom getter implementation..\r\n *       },\r\n *       set: function() {\r\n *         // Custom setter implementation..\r\n *       }\r\n *     },\r\n *     // etc..\r\n *   });\r\n * });\r\n */\r\nextendInterfaces('stub', function(context, teardown) {\r\n\r\n  return function stub(tagName, implementation) {\r\n    // Find the prototype of the element being stubbed:\r\n    var proto = document.createElement(tagName).constructor.prototype;\r\n\r\n    // For all keys in the implementation to stub with..\r\n    var stubs = Object.keys(implementation).map(function(key) {\r\n      // Stub the method on the element prototype with Sinon:\r\n      return sinon.stub(proto, key, implementation[key]);\r\n    });\r\n\r\n    // After all tests..\r\n    teardown(function() {\r\n      stubs.forEach(function(stub) {\r\n        stub.restore();\r\n      });\r\n    });\r\n  };\r\n});\r\n","import { extendInterfaces } from './extend';\r\n\r\n// replacement map stores what should be\r\nvar replacements = {};\r\nvar replaceTeardownAttached = false;\r\n\r\n/**\r\n * replace\r\n *\r\n * The replace addon allows the tester to replace all usages of one element with\r\n * another element within all Polymer elements created within the time span of\r\n * the test. Usage example:\r\n *\r\n * beforeEach(function() {\r\n *   replace('x-foo').with('x-fake-foo');\r\n * });\r\n *\r\n * All annotations and attributes will be set on the placement element the way\r\n * they were set for the original element.\r\n */\r\nextendInterfaces('replace', function (context, teardown) {\r\n  return function replace(oldTagName) {\r\n    return {\r\n      with: function (tagName) {\r\n        // Standardizes our replacements map\r\n        oldTagName = oldTagName.toLowerCase();\r\n        tagName = tagName.toLowerCase();\r\n\r\n        replacements[oldTagName] = tagName;\r\n\r\n        // If the function is already a stub, restore it to original\r\n        if (document.importNode.isSinonProxy) {\r\n          return;\r\n        }\r\n\r\n        if (!Polymer.Element) {\r\n          Polymer.Element = function () { };\r\n          Polymer.Element.prototype._stampTemplate = function () { };\r\n        }\r\n\r\n        // Keep a reference to the original `document.importNode`\r\n        // implementation for later:\r\n        var originalImportNode = document.importNode;\r\n\r\n        // Use Sinon to stub `document.ImportNode`:\r\n        sinon.stub(document, 'importNode', function (origContent, deep) {\r\n          var templateClone = document.createElement('template');\r\n          var content = templateClone.content;\r\n          var inertDoc = content.ownerDocument;\r\n\r\n          // imports node from inertDoc which holds inert nodes.\r\n          templateClone.content.appendChild(inertDoc.importNode(origContent, true));\r\n\r\n          // optional arguments are not optional on IE.\r\n          var nodeIterator = document.createNodeIterator(content,\r\n            NodeFilter.SHOW_ELEMENT, null, true);\r\n          var node;\r\n\r\n          // Traverses the tree. A recently-replaced node will be put next, so\r\n          // if a node is replaced, it will be checked if it needs to be\r\n          // replaced again.\r\n          while (node = nodeIterator.nextNode()) {\r\n            var currentTagName = node.tagName.toLowerCase();\r\n\r\n            if (replacements.hasOwnProperty(currentTagName)) {\r\n              currentTagName = replacements[currentTagName];\r\n\r\n              // find the final tag name.\r\n              while (replacements[currentTagName]) {\r\n                currentTagName = replacements[currentTagName];\r\n              }\r\n\r\n              // Create a replacement:\r\n              var replacement = document.createElement(currentTagName);\r\n\r\n              // For all attributes in the original node..\r\n              for (var index = 0; index < node.attributes.length; ++index) {\r\n                // Set that attribute on the replacement:\r\n                replacement.setAttribute(\r\n                  node.attributes[index].name, node.attributes[index].value);\r\n              }\r\n\r\n              // Replace the original node with the replacement node:\r\n              node.parentNode.replaceChild(replacement, node);\r\n            }\r\n          }\r\n\r\n          return originalImportNode.call(this, content, deep);\r\n        });\r\n\r\n        if (!replaceTeardownAttached) {\r\n          // After each test...\r\n          teardown(function () {\r\n            replaceTeardownAttached = true;\r\n            // Restore the stubbed version of `document.importNode`:\r\n            if (document.importNode.isSinonProxy) {\r\n              document.importNode.restore();\r\n            }\r\n\r\n            // Empty the replacement map\r\n            replacements = {};\r\n          });\r\n        }\r\n      }\r\n    };\r\n  };\r\n});\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport * as config from './config.js';\r\n\r\nimport './mocha/fixture.js';\r\nimport './mocha/stub.js';\r\nimport './mocha/replace.js';\r\nimport { applyExtensions } from './mocha/extend.js';\r\n\r\n// Mocha global helpers, broken out by testing method.\r\n//\r\n// Keys are the method for a particular interface; values are their analog in\r\n// the opposite interface.\r\nvar MOCHA_EXPORTS = {\r\n  // https://github.com/visionmedia/mocha/blob/master/lib/interfaces/tdd.js\r\n  tdd: {\r\n    'setup': '\"before\"',\r\n    'teardown': '\"after\"',\r\n    'suiteSetup': '\"beforeEach\"',\r\n    'suiteTeardown': '\"afterEach\"',\r\n    'suite': '\"describe\" or \"context\"',\r\n    'test': '\"it\" or \"specify\"',\r\n  },\r\n  // https://github.com/visionmedia/mocha/blob/master/lib/interfaces/bdd.js\r\n  bdd: {\r\n    'before': '\"setup\"',\r\n    'after': '\"teardown\"',\r\n    'beforeEach': '\"suiteSetup\"',\r\n    'afterEach': '\"suiteTeardown\"',\r\n    'describe': '\"suite\"',\r\n    'context': '\"suite\"',\r\n    'xdescribe': '\"suite.skip\"',\r\n    'xcontext': '\"suite.skip\"',\r\n    'it': '\"test\"',\r\n    'xit': '\"test.skip\"',\r\n    'specify': '\"test\"',\r\n    'xspecify': '\"test.skip\"',\r\n  },\r\n};\r\n\r\n/**\r\n * Exposes all Mocha methods up front, configuring and running mocha\r\n * automatically when you call them.\r\n *\r\n * The assumption is that it is a one-off (sub-)suite of tests being run.\r\n */\r\nexport function stubInterfaces() {\r\n  Object.keys(MOCHA_EXPORTS).forEach(function (ui) {\r\n    Object.keys(MOCHA_EXPORTS[ui]).forEach(function (key) {\r\n      window[key] = function wrappedMochaFunction() {\r\n        _setupMocha(ui, key, MOCHA_EXPORTS[ui][key]);\r\n        if (!window[key] || window[key] === wrappedMochaFunction) {\r\n          throw new Error('Expected mocha.setup to define ' + key);\r\n        }\r\n        window[key].apply(window, arguments);\r\n      };\r\n    });\r\n  });\r\n}\r\n\r\n// Whether we've called `mocha.setup`\r\nvar _mochaIsSetup = false;\r\n\r\n/**\r\n * @param {string} ui Sets up mocha to run `ui`-style tests.\r\n * @param {string} key The method called that triggered this.\r\n * @param {string} alternate The matching method in the opposite interface.\r\n */\r\nfunction _setupMocha(ui, key, alternate) {\r\n  var mochaOptions = config.get('mochaOptions');\r\n  if (mochaOptions.ui && mochaOptions.ui !== ui) {\r\n    var message = 'Mixing ' + mochaOptions.ui + ' and ' + ui + ' Mocha styles is not supported. ' +\r\n      'You called \"' + key + '\". Did you mean ' + alternate + '?';\r\n    throw new Error(message);\r\n  }\r\n  if (_mochaIsSetup) return;\r\n\r\n  applyExtensions();\r\n  mochaOptions.ui = ui;\r\n  mocha.setup(mochaOptions);  // Note that the reporter is configured in run.js.\r\n}\r\n\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\nimport ChildRunner from './childrunner.js';\r\nimport * as util   from './util.js';\r\n\r\nvar SOCKETIO_ENDPOINT = window.location.protocol + '//' + window.location.host;\r\nvar SOCKETIO_LIBRARY  = SOCKETIO_ENDPOINT + '/socket.io/socket.io.js';\r\n\r\n/**\r\n * A socket for communication between the CLI and browser runners.\r\n *\r\n * @param {string} browserId An ID generated by the CLI runner.\r\n * @param {!io.Socket} socket The socket.io `Socket` to communicate over.\r\n */\r\nexport default function CLISocket(browserId, socket) {\r\n  this.browserId = browserId;\r\n  this.socket    = socket;\r\n}\r\n\r\n/**\r\n * @param {!Mocha.Runner} runner The Mocha `Runner` to observe, reporting\r\n *     interesting events back to the CLI runner.\r\n */\r\nCLISocket.prototype.observe = function observe(runner) {\r\n  this.emitEvent('browser-start', {\r\n    url: window.location.toString(),\r\n  });\r\n\r\n  // We only emit a subset of events that we care about, and follow a more\r\n  // general event format that is hopefully applicable to test runners beyond\r\n  // mocha.\r\n  //\r\n  // For all possible mocha events, see:\r\n  // https://github.com/visionmedia/mocha/blob/master/lib/runner.js#L36\r\n  runner.on('test', function(test) {\r\n    this.emitEvent('test-start', {test: getTitles(test)});\r\n  }.bind(this));\r\n\r\n  runner.on('test end', function(test) {\r\n    this.emitEvent('test-end', {\r\n      state:    getState(test),\r\n      test:     getTitles(test),\r\n      duration: test.duration,\r\n      error:    test.err,\r\n    });\r\n  }.bind(this));\r\n\r\n  runner.on('fail', function(test, err) {\r\n    // fail the test run if we catch errors outside of a test function\r\n    if (test.type !== 'test') {\r\n      this.emitEvent('browser-fail', 'Error thrown outside of test function: ' + err.stack);\r\n    }\r\n  }.bind(this));\r\n\r\n  runner.on('childRunner start', function(childRunner) {\r\n    this.emitEvent('sub-suite-start', childRunner.share);\r\n  }.bind(this));\r\n\r\n  runner.on('childRunner end', function(childRunner) {\r\n    this.emitEvent('sub-suite-end', childRunner.share);\r\n  }.bind(this));\r\n\r\n  runner.on('end', function() {\r\n    this.emitEvent('browser-end');\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n * @param {string} event The name of the event to fire.\r\n * @param {*} data Additional data to pass with the event.\r\n */\r\nCLISocket.prototype.emitEvent = function emitEvent(event, data) {\r\n  this.socket.emit('client-event', {\r\n    browserId: this.browserId,\r\n    event:     event,\r\n    data:      data,\r\n  });\r\n};\r\n\r\n/**\r\n * Builds a `CLISocket` if we are within a CLI-run environment; short-circuits\r\n * otherwise.\r\n *\r\n * @param {function(*, CLISocket)} done Node-style callback.\r\n */\r\nCLISocket.init = function init(done) {\r\n  var browserId = util.getParam('cli_browser_id');\r\n  if (!browserId) return done();\r\n  // Only fire up the socket for root runners.\r\n  if (ChildRunner.current()) return done();\r\n\r\n  util.loadScript(SOCKETIO_LIBRARY, function(error) {\r\n    if (error) return done(error);\r\n\r\n    var socket = io(SOCKETIO_ENDPOINT);\r\n    socket.on('error', function(error) {\r\n      socket.off();\r\n      done(error);\r\n    });\r\n\r\n    socket.on('connect', function() {\r\n      socket.off();\r\n      done(null, new CLISocket(browserId, socket));\r\n    });\r\n  });\r\n};\r\n\r\n// Misc Utility\r\n\r\n/**\r\n * @param {!Mocha.Runnable} runnable The test or suite to extract titles from.\r\n * @return {!Array.<string>} The titles of the runnable and its parents.\r\n */\r\nfunction getTitles(runnable) {\r\n  var titles = [];\r\n  while (runnable && !runnable.root && runnable.title) {\r\n    titles.unshift(runnable.title);\r\n    runnable = runnable.parent;\r\n  }\r\n  return titles;\r\n}\r\n\r\n/**\r\n * @param {!Mocha.Runnable} runnable\r\n * @return {string}\r\n */\r\nfunction getState(runnable) {\r\n  if (runnable.state === 'passed') {\r\n    return 'passing';\r\n  } else if (runnable.state == 'failed') {\r\n    return 'failing';\r\n  } else if (runnable.pending) {\r\n    return 'pending';\r\n  } else {\r\n    return 'unknown';\r\n  }\r\n}\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\n\r\n// Make sure that we use native timers, in case they're being stubbed out.\r\nvar setInterval           = window.setInterval;           // jshint ignore:line\r\nvar setTimeout            = window.setTimeout;            // jshint ignore:line\r\nvar requestAnimationFrame = window.requestAnimationFrame; // jshint ignore:line\r\n\r\n/**\r\n * Runs `stepFn`, catching any error and passing it to `callback` (Node-style).\r\n * Otherwise, calls `callback` with no arguments on success.\r\n *\r\n * @param {function()} callback\r\n * @param {function()} stepFn\r\n */\r\nwindow.safeStep = function safeStep(callback, stepFn) {\r\n  var err;\r\n  try {\r\n    stepFn();\r\n  } catch (error) {\r\n    err = error;\r\n  }\r\n  callback(err);\r\n};\r\n\r\n/**\r\n * Runs your test at declaration time (before Mocha has begun tests). Handy for\r\n * when you need to test document initialization.\r\n *\r\n * Be aware that any errors thrown asynchronously cannot be tied to your test.\r\n * You may want to catch them and pass them to the done event, instead. See\r\n * `safeStep`.\r\n *\r\n * @param {string} name The name of the test.\r\n * @param {function(?function())} testFn The test function. If an argument is\r\n *     accepted, the test will be treated as async, just like Mocha tests.\r\n */\r\nwindow.testImmediate = function testImmediate(name, testFn) {\r\n  if (testFn.length > 0) {\r\n    return testImmediateAsync(name, testFn);\r\n  }\r\n\r\n  var err;\r\n  try {\r\n    testFn();\r\n  } catch (error) {\r\n    err = error;\r\n  }\r\n\r\n  test(name, function(done) {\r\n    done(err);\r\n  });\r\n};\r\n\r\n/**\r\n * An async-only variant of `testImmediate`.\r\n *\r\n * @param {string} name\r\n * @param {function(?function())} testFn\r\n */\r\nwindow.testImmediateAsync = function testImmediateAsync(name, testFn) {\r\n  var testComplete = false;\r\n  var err;\r\n\r\n  test(name, function(done) {\r\n    var intervalId = setInterval(function() {\r\n      if (!testComplete) return;\r\n      clearInterval(intervalId);\r\n      done(err);\r\n    }, 10);\r\n  });\r\n\r\n  try {\r\n    testFn(function(error) {\r\n      if (error) err = error;\r\n      testComplete = true;\r\n    });\r\n  } catch (error) {\r\n    err = error;\r\n    testComplete = true;\r\n  }\r\n};\r\n\r\n/**\r\n * Triggers a flush of any pending events, observations, etc and calls you back\r\n * after they have been processed.\r\n *\r\n * @param {function()} callback\r\n */\r\nwindow.flush = function flush(callback) {\r\n  // Ideally, this function would be a call to Polymer.dom.flush, but that doesn't\r\n  // support a callback yet (https://github.com/Polymer/polymer-dev/issues/851),\r\n  // ...and there's cross-browser flakiness to deal with.\r\n\r\n  // Make sure that we're invoking the callback with no arguments so that the\r\n  // caller can pass Mocha callbacks, etc.\r\n  var done = function done() { callback(); };\r\n\r\n  // Because endOfMicrotask is flaky for IE, we perform microtask checkpoints\r\n  // ourselves (https://github.com/Polymer/polymer-dev/issues/114):\r\n  var isIE = navigator.appName == 'Microsoft Internet Explorer';\r\n  if (isIE && window.Platform && window.Platform.performMicrotaskCheckpoint) {\r\n    var reallyDone = done;\r\n    done = function doneIE() {\r\n      Platform.performMicrotaskCheckpoint();\r\n      setTimeout(reallyDone, 0);\r\n    };\r\n  }\r\n\r\n  // Everyone else gets a regular flush.\r\n  var scope;\r\n  if (window.Polymer && window.Polymer.dom && window.Polymer.dom.flush) {\r\n    scope = window.Polymer.dom;\r\n  } else if (window.Polymer && window.Polymer.flush) {\r\n    scope = window.Polymer;\r\n  } else if (window.WebComponents && window.WebComponents.flush) {\r\n    scope = window.WebComponents;\r\n  }\r\n  if (scope) {\r\n    scope.flush();\r\n  }\r\n\r\n  // Ensure that we are creating a new _task_ to allow all active microtasks to\r\n  // finish (the code you're testing may be using endOfMicrotask, too).\r\n  setTimeout(done, 0);\r\n};\r\n\r\n/**\r\n * Advances a single animation frame.\r\n *\r\n * Calls `flush`, `requestAnimationFrame`, `flush`, and `callback` sequentially\r\n * @param {function()} callback\r\n */\r\nwindow.animationFrameFlush = function animationFrameFlush(callback) {\r\n  flush(function() {\r\n    requestAnimationFrame(function() {\r\n      flush(callback);\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * DEPRECATED: Use `flush`.\r\n * @param {function} callback\r\n */\r\nwindow.asyncPlatformFlush = function asyncPlatformFlush(callback) {\r\n  console.warn('asyncPlatformFlush is deprecated in favor of the more terse flush()');\r\n  return window.flush(callback);\r\n};\r\n\r\n/**\r\n *\r\n */\r\nwindow.waitFor = function waitFor(fn, next, intervalOrMutationEl, timeout, timeoutTime) {\r\n  timeoutTime = timeoutTime || Date.now() + (timeout || 1000);\r\n  intervalOrMutationEl = intervalOrMutationEl || 32;\r\n  try {\r\n    fn();\r\n  } catch (e) {\r\n    if (Date.now() > timeoutTime) {\r\n      throw e;\r\n    } else {\r\n      if (isNaN(intervalOrMutationEl)) {\r\n        intervalOrMutationEl.onMutation(intervalOrMutationEl, function() {\r\n          waitFor(fn, next, intervalOrMutationEl, timeout, timeoutTime);\r\n        });\r\n      } else {\r\n        setTimeout(function() {\r\n          waitFor(fn, next, intervalOrMutationEl, timeout, timeoutTime);\r\n        }, intervalOrMutationEl);\r\n      }\r\n      return;\r\n    }\r\n  }\r\n  next();\r\n};\r\n","/**\r\n * @license\r\n * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.\r\n * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt\r\n * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt\r\n * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt\r\n * Code distributed by Google as part of the polymer project is also\r\n * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt\r\n */\r\n/**\r\n * This file is the entry point into `web-component-tester`'s browser client.\r\n */\r\nimport * as config      from './config.js';\r\nimport * as environment from './environment.js';\r\nimport * as errors      from './environment/errors.js';\r\nimport * as mocha       from './mocha';\r\nimport * as reporters   from './reporters';\r\nimport * as suites      from './suites.js';\r\nimport * as util        from './util.js';\r\nimport CLISocket        from './clisocket.js';\r\nimport ChildRunner      from './childrunner.js';\r\nimport MultiReporter    from './reporters/multi.js';\r\n// Registers a bunch of globals:\r\nimport './environment/helpers.js';\r\n\r\n// You can configure WCT before it has loaded by assigning your custom\r\n// configuration to the global `WCT`.\r\nconfig.setup(window.WCT);\r\n\r\n// Maybe some day we'll expose WCT as a module to whatever module registry you\r\n// are using (aka the UMD approach), or as an es6 module.\r\nvar WCT = window.WCT = {};\r\n// A generic place to hang data about the current suite. This object is reported\r\n// back via the `sub-suite-start` and `sub-suite-end` events.\r\nWCT.share = {};\r\n// Until then, we get to rely on it to expose parent runners to their children.\r\nWCT._ChildRunner = ChildRunner;\r\nWCT._config      = config._config;\r\n\r\n\r\n// Public Interface\r\n\r\n/**\r\n * Loads suites of tests, supporting both `.js` and `.html` files.\r\n *\r\n * @param {!Array.<string>} files The files to load.\r\n */\r\nWCT.loadSuites = suites.loadSuites;\r\n\r\n\r\n// Load Process\r\n\r\nerrors.listenForErrors();\r\nmocha.stubInterfaces();\r\nenvironment.loadSync();\r\n\r\n// Give any scripts on the page a chance to declare tests and muck with things.\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n  util.debug('DOMContentLoaded');\r\n\r\n  environment.ensureDependenciesPresent();\r\n\r\n  // We need the socket built prior to building its reporter.\r\n  CLISocket.init(function(error, socket) {\r\n    if (error) throw error;\r\n\r\n    // Are we a child of another run?\r\n    var current = ChildRunner.current();\r\n    var parent  = current && current.parentScope.WCT._reporter;\r\n    util.debug('parentReporter:', parent);\r\n\r\n    var childSuites    = suites.activeChildSuites();\r\n    var reportersToUse = reporters.determineReporters(socket, parent);\r\n    // +1 for any local tests.\r\n    var reporter = new MultiReporter(childSuites.length + 1, reportersToUse, parent);\r\n    WCT._reporter = reporter; // For environment/compatibility.js\r\n\r\n    // We need the reporter so that we can report errors during load.\r\n    suites.loadJsSuites(reporter, function(error) {\r\n      // Let our parent know that we're about to start the tests.\r\n      if (current) current.ready(error);\r\n      if (error) throw error;\r\n\r\n      // Emit any errors we've encountered up til now\r\n      errors.globalErrors.forEach(function onError(error) {\r\n        reporter.emitOutOfBandTest('Test Suite Initialization', error);\r\n      });\r\n\r\n      suites.runSuites(reporter, childSuites, function(error) {\r\n        // Make sure to let our parent know that we're done.\r\n        if (current) current.done();\r\n        if (error) throw error;\r\n      });\r\n    });\r\n  });\r\n});\r\n"],"names":["config.get","util.paramsToQuery","util.getParams","util.mergeParams","util.parseUrl","util.debug","util.basePath","util.scriptPrefix","htmlSuites","jsSuites","util.getParam","util.cleanLocation","util.parallel","util.loadScript","util.whenFrameworksReady","console","util.pluralizedStat","util.relativeLocation","HTMLReporter","suites.jsSuites","suites.htmlSuites","ConsoleReporter","TitleReporter","util.expandUrl","util.loadStyle","reporters.injectMocha","setTimeout","config.setup","config._config","suites.loadSuites","errors.listenForErrors","mocha.stubInterfaces","environment.loadSync","suites.runSuites","errors.globalErrors","suites.loadJsSuites","reporters.determineReporters","suites.activeChildSuites","environment.ensureDependenciesPresent"],"mappings":"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"}